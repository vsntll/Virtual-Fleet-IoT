{% extends "base.html" %}

{% block title %}Device Analysis: {{ device.id }}{% endblock %}

{% block content %}
    {% if device %}
    <h1 class="text-2xl font-bold mb-4">Device Analysis: {{ device.id }}</h1>
    <p>Viewing analysis for device: {{ device.id }}</p>

    <div class="chart-container">
        <canvas id="tempChart"></canvas>
    </div>

    {% else %}
    <h1>Device not found</h1>
    {% endif %}
    <br>
    <a href="/devices/{{ device.id }}" class="button">Back to Device Details</a>
    <a href="/" class="button">Back to Fleet</a>
{% endblock %}

{% block scripts %}
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        const measurements = {{ measurements | safe }};

        if (measurements && measurements.length > 0) {
            const labels = measurements.map(m => new Date(m.timestamp).toLocaleString());
            const tempData = measurements.map(m => m.temp);

            const ctx = document.getElementById('tempChart').getContext('2d');
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Temperature',
                        data: tempData,
                        borderColor: 'rgb(75, 192, 192)',
                        tension: 0.1,
                        fill: false
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            type: 'category',
                            labels: labels,
                            title: {
                                display: true,
                                text: 'Time'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Temperature (Â°C)'
                            }
                        }
                    }
                }
            });
        }
    </script>
{% endblock %}
